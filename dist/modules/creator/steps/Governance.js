'use strict';var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}function rejected(value){try{step(generator['throw'](value));}catch(e){reject(e);}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{'default':mod};};Object.defineProperty(exports,'__esModule',{value:true});exports.Governance=void 0;const jsx_runtime_1=require('react/jsx-runtime');const core_1=require('@material-ui/core');const formik_material_ui_1=require('formik-material-ui');const react_1=require('react');const formik_1=require('formik');const react_router_1=require('react-router');const react_router_dom_1=require('react-router-dom');const state_1=require('../state');const icons_1=require('@material-ui/icons');const stats_1=require('../../../services/bakingBad/stats');const useTezos_1=require('../../../services/beacon/hooks/useTezos');const EstimatedTime_1=require('../../explorer/components/EstimatedTime');const dayjs_1=__importDefault(require('dayjs'));const TitleBlock_1=require('../../common/TitleBlock');const bignumber_js_1=__importDefault(require('bignumber.js'));const utils_1=require('../../../services/contracts/utils');const utils_2=require('../utils');const TimeBox=(0,core_1.styled)(core_1.Grid)(({theme})=>({background:theme.palette.primary.dark,borderRadius:8,width:72,minHeight:59,marginBottom:16,display:'grid'}));const TimeText=(0,core_1.styled)(core_1.Typography)({marginTop:-20,marginLeft:16});const CustomTooltip=(0,core_1.styled)(core_1.Tooltip)({marginLeft:8});const InfoIconInput=(0,core_1.styled)(icons_1.InfoRounded)(({theme})=>({cursor:'default',color:theme.palette.secondary.light,height:16,width:16,marginLeft:8}));const InfoIconDanger=(0,core_1.styled)(icons_1.InfoRounded)(({theme})=>({cursor:'default',color:theme.palette.error.main,height:16,width:16}));const InfoIconCorrect=(0,core_1.styled)(icons_1.InfoRounded)(({theme})=>({cursor:'default',color:theme.palette.secondary.main,height:16,width:16}));const ErrorText=(0,core_1.styled)(core_1.Typography)({display:'block',fontSize:14,color:'red'});const ErrorTextTime=(0,core_1.styled)(core_1.Typography)({display:'block',fontSize:14,color:'red',marginTop:-14});const SecondContainer=(0,core_1.styled)(core_1.Grid)({marginTop:10});const SpacingContainer=(0,core_1.styled)(core_1.Grid)({marginTop:25});const StakeContainer=(0,core_1.styled)(core_1.Grid)({display:'block'});const AdditionContainer=(0,core_1.styled)(core_1.Grid)(({theme})=>({marginTop:14,border:'none',height:54,background:'#2F3438',borderRadius:8,marginRight:15,['@media (max-width:1167px)']:{marginRight:0}}));const GridItemCenter=(0,core_1.styled)(core_1.Grid)({textAlign:'center',alignItems:'center',display:'flex',justifyContent:'flex-end'});const ItemContainer=(0,core_1.styled)(core_1.Grid)(({theme})=>({height:'100%',padding:'12px 25px'}));const ValueText=(0,core_1.styled)(core_1.Typography)({fontSize:14});const StyledSlider=(0,core_1.withStyles)({root:{textAlign:'center',width:'100%'},valueLabel:{textAlign:'center'},thumb:{height:20,width:20,top:'36.5%',backgroundColor:'#fff',border:'3px solid #fff'},track:{backgroundColor:'#4BCF93',borderRadius:'4px',height:2}})(core_1.Slider);const CustomSliderValue=(0,core_1.styled)((0,core_1.withTheme)(core_1.Paper))(props=>({boxShadow:'none',height:54,display:'flex',alignItems:'center',justifyContent:'center',background:'#2F3438',borderRadius:8,width:97}));const Value=(0,core_1.styled)(core_1.Typography)({textAlign:'center',padding:'15%'});const styles={voting:{marginTop:6,marginBottom:16}};const InputContainer=(0,core_1.styled)(core_1.Grid)({paddingRight:15,['@media (max-width:1167px)']:{paddingRight:0}});const CustomFormikTextField=(0,core_1.withStyles)({root:{'& input':{textAlign:'center'}}})(formik_material_ui_1.TextField);const GridNoPadding=(0,core_1.styled)(core_1.Grid)({paddingLeft:'8px !important'});const InfoBox=(0,core_1.styled)(core_1.Paper)({boxShadow:'none',border:'none',background:'inherit',marginTop:20});const validateForm=values=>{const errors={};Object.keys(values).forEach(key=>{if(values[key]===''){errors[key]='Required';}if(Number(values[key])<0){errors[key]='Cannot be negative';}});if(!values.votingBlocks||values.votingBlocks<=0){errors.votingBlocks='Must be greater than 0';}if(!values.proposalFlushBlocks||Number(values.proposalFlushBlocks)<=0){errors.proposalFlushBlocks='Must be greater than 0';}if(!values.proposalExpiryBlocks||Number(values.proposalExpiryBlocks)<=0){errors.proposalExpiryBlocks='Must be greater than 0';}if(new bignumber_js_1.default(values.proposeStakeRequired).lte(new bignumber_js_1.default(0))){errors.proposeStakeRequired='Must be greater than 0';}if(values.maxXtzAmount<=0){errors.maxXtzAmount='Must be greater than 0';}if(values.minXtzAmount&&new bignumber_js_1.default(values.minXtzAmount).lt((0,utils_1.mutezToXtz)(new bignumber_js_1.default(1)))){errors.minXtzAmount='Too small, number must be bigger';}if(values.maxXtzAmount&&String(values.maxXtzAmount).length>255){errors.maxXtzAmount='Too big, number must be smaller';}if(values.minXtzAmount&&String(values.minXtzAmount).length>255){errors.minXtzAmount='Too big, number must be smaller';}if(values.minXtzAmount>values.maxXtzAmount){errors.maxXtzAmount='Must be greater than Min. XTZ amount';}return errors;};const secondsToTime=seconds=>({days:Math.floor(seconds/(3600*24)),hours:Math.floor(seconds%(3600*24)/3600),minutes:Math.floor(seconds%3600/60)});const useEstimatedBlocks=({votingBlocksDay,votingBlocksMinutes,votingBlocksHours,proposalFlushBlocksDay,proposalFlushBlocksHours,proposalFlushBlocksMinutes,proposalExpiryBlocksDay,proposalExpiryBlocksHours,proposalExpiryBlocksMinutes,blockTimeAverage})=>{const now=(0,dayjs_1.default)();let periodSeconds=votingBlocksDay*86400;periodSeconds+=votingBlocksHours*3600;periodSeconds+=votingBlocksMinutes*60;const periodBlocks=Math.round(periodSeconds/blockTimeAverage);let flushDelaySeconds=proposalFlushBlocksDay*86400;flushDelaySeconds+=proposalFlushBlocksHours*3600;flushDelaySeconds+=proposalFlushBlocksMinutes*60;const flushBlocks=Math.round(flushDelaySeconds/blockTimeAverage);let expiryDelaySeconds=proposalExpiryBlocksDay*86400;expiryDelaySeconds+=proposalExpiryBlocksHours*3600;expiryDelaySeconds+=proposalExpiryBlocksMinutes*60;const expiryBlocks=Math.round(expiryDelaySeconds/blockTimeAverage);const creationMoment=now.add(periodSeconds,'s');const activeMoment=creationMoment.add(periodSeconds,'s');const closeMoment=activeMoment.add(periodSeconds,'s');const flushMoment=closeMoment.add(flushDelaySeconds,'s');const expiryMoment=flushMoment.add(expiryDelaySeconds,'s');return{periodBlocks,flushBlocks,expiryBlocks,creationMoment,activeMoment,closeMoment,flushMoment,expiryMoment,votingTime:secondsToTime(periodSeconds),flushDelayTime:secondsToTime(flushDelaySeconds),expiryDelayTime:secondsToTime(expiryDelaySeconds),periodSeconds};};const GovernanceForm=({submitForm,values,setFieldValue,errors,touched,setFieldTouched})=>{var _a,_b,_c;const {network}=(0,useTezos_1.useTezos)();const {dispatch,state:{data:{orgSettings}}}=(0,react_1.useContext)(state_1.CreatorContext);const match=(0,react_router_dom_1.useRouteMatch)();const history=(0,react_router_1.useHistory)();const [blockTimeAverage,setBlockTimeAverage]=(0,react_1.useState)(0);const {votingBlocksDay,votingBlocksMinutes,votingBlocksHours,proposalFlushBlocksDay,proposalFlushBlocksHours,proposalFlushBlocksMinutes,proposalExpiryBlocksDay,proposalExpiryBlocksHours,proposalExpiryBlocksMinutes}=values;const {votingTime,flushDelayTime,activeMoment,expiryDelayTime,periodSeconds,periodBlocks,flushBlocks,expiryBlocks}=useEstimatedBlocks({votingBlocksDay,votingBlocksMinutes,votingBlocksHours,proposalFlushBlocksDay,proposalFlushBlocksHours,proposalFlushBlocksMinutes,proposalExpiryBlocksDay,proposalExpiryBlocksHours,proposalExpiryBlocksMinutes,blockTimeAverage});(0,react_1.useEffect)(()=>{setFieldValue('votingBlocks',periodBlocks);setFieldValue('proposalFlushBlocks',flushBlocks);setFieldValue('proposalExpiryBlocks',expiryBlocks);},[values,periodBlocks,flushBlocks,expiryBlocks,setFieldValue]);(0,react_1.useEffect)(()=>{;(()=>__awaiter(void 0,void 0,void 0,function*(){const blockchainInfo=yield(0,stats_1.getNetworkStats)(network);if(blockchainInfo){setBlockTimeAverage(blockchainInfo.constants.timeBetweenBlocks);}}))();},[network]);const formatDate=timeInfo=>{const values=[];for(const property in timeInfo){if(timeInfo[property]!==0){values.push(`${timeInfo[property]} ${property}`);}}if(values.length>0){return values.toString().replace(',',' and ');}return'0 minutes';};(0,react_1.useEffect)(()=>{if(values){dispatch({type:state_1.ActionTypes.UPDATE_NAVIGATION_BAR,next:{text:'Continue',handler:()=>{submitForm(values);}},back:{text:'Back',handler:()=>history.push(`dao`)}});}},[dispatch,errors,history,match.path,match.url,submitForm,values]);return(0,jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment,{children:[(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,direction:'row',children:[(0,jsx_runtime_1.jsxs)(InputContainer,{item:true,sm:4,xs:12,children:[(0,jsx_runtime_1.jsx)(SecondContainer,{container:true,direction:'row',children:(0,jsx_runtime_1.jsx)(core_1.Typography,{style:styles.voting,variant:'subtitle1',color:'textSecondary',children:'Voting Cycle Duration'})}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,direction:'column',children:[(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,container:true,direction:'row',alignItems:'center',children:[(0,jsx_runtime_1.jsx)(TimeBox,{item:true,children:(0,jsx_runtime_1.jsx)(formik_1.Field,{style:{margin:'auto'},id:'outlined-basic',onKeyDown:e=>(0,utils_2.handleChange)(e),name:'votingBlocksDay',type:'number',placeholder:'0',component:CustomFormikTextField,inputProps:{min:0},onClick:()=>{if((0,formik_1.getIn)(values,'votingBlocksDay')===0){setFieldValue('votingBlocksDay','');setFieldTouched('votingBlocksDay');}},onChange:newValue=>{if(newValue.target.value===''){setFieldValue('votingBlocksDay','');}else{setFieldValue('votingBlocksDay',parseInt(newValue.target.value,10));}}})}),(0,jsx_runtime_1.jsx)(TimeText,{color:'textSecondary',children:'days'})]}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,container:true,direction:'row',alignItems:'center',children:[(0,jsx_runtime_1.jsx)(TimeBox,{item:true,children:(0,jsx_runtime_1.jsx)(formik_1.Field,{style:{margin:'auto'},id:'outlined-basic',onKeyDown:e=>(0,utils_2.handleChange)(e),name:'votingBlocksHours',type:'number',component:CustomFormikTextField,inputProps:{min:0},onClick:()=>{if((0,formik_1.getIn)(values,'votingBlocksHours')===0){setFieldValue('votingBlocksHours','');}},onChange:newValue=>{if(newValue.target.value===''){setFieldValue('votingBlocksHours','');}else{setFieldValue('votingBlocksHours',parseInt(newValue.target.value,10));}}})}),(0,jsx_runtime_1.jsx)(TimeText,{color:'textSecondary',children:'hours'})]}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,container:true,direction:'row',alignItems:'center',children:[(0,jsx_runtime_1.jsx)(TimeBox,{item:true,children:(0,jsx_runtime_1.jsx)(formik_1.Field,{style:{margin:'auto'},id:'outlined-basic',onKeyDown:e=>(0,utils_2.handleChange)(e),name:'votingBlocksMinutes',type:'number',component:CustomFormikTextField,inputProps:{min:0},onClick:()=>{if((0,formik_1.getIn)(values,'votingBlocksMinutes')===0){setFieldValue('votingBlocksMinutes','');}},onChange:newValue=>{if(newValue.target.value===''){setFieldValue('votingBlocksMinutes','');}else{setFieldValue('votingBlocksMinutes',parseInt(newValue.target.value,10));}}})}),(0,jsx_runtime_1.jsx)(TimeText,{color:'textSecondary',children:'minutes'})]})]}),(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,style:{marginTop:10,marginLeft:0,height:42},children:(0,jsx_runtime_1.jsx)(EstimatedTime_1.EstimatedBlocks,{blocks:periodBlocks})}),(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:errors.votingBlocks&&(touched.votingBlocksDay||touched.votingBlocksMinutes||touched.votingBlocksHours)?(0,jsx_runtime_1.jsx)(ErrorTextTime,{children:errors.votingBlocks}):null})]}),(0,jsx_runtime_1.jsxs)(InputContainer,{item:true,sm:4,xs:12,children:[(0,jsx_runtime_1.jsx)(SecondContainer,{container:true,direction:'row',children:(0,jsx_runtime_1.jsxs)(core_1.Typography,{style:styles.voting,variant:'subtitle1',color:'textSecondary',children:['Proposal Execution Delay',(0,jsx_runtime_1.jsx)(CustomTooltip,{placement:'bottom',title:'The time for which the proposal execution will be paused, after this time has passed the proposal will be executable',children:errors.proposalFlushBlocks?(0,jsx_runtime_1.jsx)(InfoIconDanger,{}):(0,jsx_runtime_1.jsx)(InfoIconCorrect,{})})]})}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,direction:'column',children:[(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,container:true,direction:'row',alignItems:'center',children:[(0,jsx_runtime_1.jsx)(TimeBox,{item:true,children:(0,jsx_runtime_1.jsx)(formik_1.Field,{style:{margin:'auto'},id:'outlined-basic',onKeyDown:e=>(0,utils_2.handleChange)(e),name:'proposalFlushBlocksDay',type:'number',component:CustomFormikTextField,inputProps:{min:0},onClick:()=>{if((0,formik_1.getIn)(values,'proposalFlushBlocksDay')===0){setFieldValue('proposalFlushBlocksDay','');}},onChange:newValue=>{if(newValue.target.value===''){setFieldValue('proposalFlushBlocksDay','');}else{setFieldValue('proposalFlushBlocksDay',parseInt(newValue.target.value,10));}}})}),(0,jsx_runtime_1.jsx)(TimeText,{color:'textSecondary',children:'days'})]}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,container:true,direction:'row',alignItems:'center',children:[(0,jsx_runtime_1.jsx)(TimeBox,{item:true,children:(0,jsx_runtime_1.jsx)(formik_1.Field,{style:{margin:'auto'},id:'outlined-basic',onKeyDown:e=>(0,utils_2.handleChange)(e),name:'proposalFlushBlocksHours',type:'number',component:CustomFormikTextField,inputProps:{min:0},onClick:()=>{if((0,formik_1.getIn)(values,'proposalFlushBlocksHours')===0){setFieldValue('proposalFlushBlocksHours','');}},onChange:newValue=>{if(newValue.target.value===''){setFieldValue('proposalFlushBlocksHours','');}else{setFieldValue('proposalFlushBlocksHours',parseInt(newValue.target.value,10));}}})}),(0,jsx_runtime_1.jsx)(TimeText,{color:'textSecondary',children:'hours'})]}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,container:true,direction:'row',alignItems:'center',children:[(0,jsx_runtime_1.jsx)(TimeBox,{item:true,children:(0,jsx_runtime_1.jsx)(formik_1.Field,{style:{margin:'auto'},id:'outlined-basic',onKeyDown:e=>(0,utils_2.handleChange)(e),name:'proposalFlushBlocksMinutes',type:'number',component:CustomFormikTextField,inputProps:{min:0},onClick:()=>{if((0,formik_1.getIn)(values,'proposalFlushBlocksMinutes')===0){setFieldValue('proposalFlushBlocksMinutes','');}},onChange:newValue=>{if(newValue.target.value===''){setFieldValue('proposalFlushBlocksMinutes','');}else{setFieldValue('proposalFlushBlocksMinutes',parseInt(newValue.target.value,10));}}})}),(0,jsx_runtime_1.jsx)(TimeText,{color:'textSecondary',children:'minutes'})]})]}),(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,style:{marginLeft:0,height:42,marginTop:10},children:(0,jsx_runtime_1.jsx)(EstimatedTime_1.EstimatedBlocks,{blocks:flushBlocks})}),(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:errors.proposalFlushBlocks&&(touched.proposalFlushBlocksDay||touched.proposalFlushBlocksMinutes||touched.proposalFlushBlocksHours)?(0,jsx_runtime_1.jsx)(ErrorTextTime,{children:errors.proposalFlushBlocks}):null})]}),(0,jsx_runtime_1.jsxs)(InputContainer,{item:true,sm:4,xs:12,children:[(0,jsx_runtime_1.jsx)(SecondContainer,{container:true,direction:'row',children:(0,jsx_runtime_1.jsxs)(core_1.Typography,{style:styles.voting,variant:'subtitle1',color:'textSecondary',children:['Proposal Expiry Threshold',(0,jsx_runtime_1.jsx)(CustomTooltip,{placement:'bottom',title:'This is the time after which if you still haven\'t executed your proposal it will become expired and non-executable',children:errors.proposalExpiryBlocks?(0,jsx_runtime_1.jsx)(InfoIconDanger,{}):(0,jsx_runtime_1.jsx)(InfoIconCorrect,{})})]})}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,direction:'column',children:[(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,container:true,direction:'row',alignItems:'center',children:[(0,jsx_runtime_1.jsx)(TimeBox,{item:true,children:(0,jsx_runtime_1.jsx)(formik_1.Field,{style:{margin:'auto'},id:'outlined-basic',onKeyDown:e=>(0,utils_2.handleChange)(e),name:'proposalExpiryBlocksDay',type:'number',component:CustomFormikTextField,inputProps:{min:0},onClick:()=>{if((0,formik_1.getIn)(values,'proposalExpiryBlocksDay')===0){setFieldValue('proposalExpiryBlocksDay','');}},onChange:newValue=>{if(newValue.target.value===''){setFieldValue('proposalExpiryBlocksDay','');}else{setFieldValue('proposalExpiryBlocksDay',parseInt(newValue.target.value,10));}}})}),(0,jsx_runtime_1.jsx)(TimeText,{color:'textSecondary',children:'days'})]}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,container:true,direction:'row',alignItems:'center',children:[(0,jsx_runtime_1.jsx)(TimeBox,{item:true,children:(0,jsx_runtime_1.jsx)(formik_1.Field,{style:{margin:'auto'},id:'outlined-basic',onKeyDown:e=>(0,utils_2.handleChange)(e),name:'proposalExpiryBlocksHours',type:'number',component:CustomFormikTextField,inputProps:{min:0},onClick:()=>{if((0,formik_1.getIn)(values,'proposalExpiryBlocksHours')===0){setFieldValue('proposalExpiryBlocksHours','');}},onChange:newValue=>{if(newValue.target.value===''){setFieldValue('proposalExpiryBlocksHours','');}else{setFieldValue('proposalExpiryBlocksHours',parseInt(newValue.target.value,10));}}})}),(0,jsx_runtime_1.jsx)(TimeText,{color:'textSecondary',children:'hours'})]}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,container:true,direction:'row',alignItems:'center',children:[(0,jsx_runtime_1.jsx)(TimeBox,{item:true,children:(0,jsx_runtime_1.jsx)(formik_1.Field,{style:{margin:'auto'},id:'outlined-basic',onKeyDown:e=>(0,utils_2.handleChange)(e),name:'proposalExpiryBlocksMinutes',type:'number',component:CustomFormikTextField,inputProps:{min:0},onClick:()=>{if((0,formik_1.getIn)(values,'proposalExpiryBlocksMinutes')===0){setFieldValue('proposalExpiryBlocksMinutes','');}},onChange:newValue=>{if(newValue.target.value===''){setFieldValue('proposalExpiryBlocksMinutes','');}else{setFieldValue('proposalExpiryBlocksMinutes',parseInt(newValue.target.value,10));}}})}),(0,jsx_runtime_1.jsx)(TimeText,{color:'textSecondary',children:'minutes'})]})]}),(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,style:{marginLeft:0,height:42,marginTop:10},children:(0,jsx_runtime_1.jsx)(EstimatedTime_1.EstimatedBlocks,{blocks:expiryBlocks})}),(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:errors.proposalExpiryBlocks&&(touched.proposalExpiryBlocksDay||touched.proposalExpiryBlocksHours||touched.proposalExpiryBlocksMinutes)?(0,jsx_runtime_1.jsx)(ErrorTextTime,{children:errors.proposalExpiryBlocks}):null})]})]}),(0,jsx_runtime_1.jsx)(InfoBox,{children:(0,jsx_runtime_1.jsx)(TitleBlock_1.TitleBlock,{description:(0,jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment,{children:[(0,jsx_runtime_1.jsx)(core_1.Typography,{color:'textSecondary',children:'You will need to wait for a full cycle before making your first proposal.'}),(0,jsx_runtime_1.jsx)(core_1.Typography,{color:'textSecondary',style:{marginTop:10},children:`A proposal will accept votes for ${formatDate(votingTime)} after it is created. Once the voting cycle
                ends, if the proposal is accepted, it will become executable after another ${formatDate(flushDelayTime)}.`}),(0,jsx_runtime_1.jsxs)(core_1.Typography,{color:'textSecondary',style:{marginTop:10},children:['If not executed within ',formatDate(expiryDelayTime),' after voting ends, the proposal will expire and won\'t be available for execution anymore.']})]})})}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,style:{marginTop:12},children:[(0,jsx_runtime_1.jsx)(SecondContainer,{container:true,direction:'row',children:(0,jsx_runtime_1.jsx)(core_1.Typography,{style:styles.voting,variant:'subtitle1',color:'textSecondary',children:'Required Stake to Propose'})}),(0,jsx_runtime_1.jsxs)(StakeContainer,{container:true,direction:'row',alignItems:'center',children:[(0,jsx_runtime_1.jsx)(AdditionContainer,{item:true,xs:12,sm:4,children:(0,jsx_runtime_1.jsxs)(ItemContainer,{container:true,direction:'row',alignItems:'center',justifyContent:'center',children:[(0,jsx_runtime_1.jsx)(GridItemCenter,{item:true,xs:5,children:(0,jsx_runtime_1.jsx)(formik_1.Field,{name:'proposeStakeRequired',type:'string',placeholder:'00',inputProps:{min:0,defaultValue:0,step:0.01},component:formik_material_ui_1.TextField,validate:value=>{var _a,_b;let error;if(((_a=orgSettings.governanceToken.tokenMetadata)===null||_a===void 0?void 0:_a.decimals)&&new bignumber_js_1.default(value).lt((0,utils_1.parseUnits)(new bignumber_js_1.default(1),(_b=orgSettings.governanceToken.tokenMetadata)===null||_b===void 0?void 0:_b.decimals))){error='Token value lower than smallest valid token value';}return error;},onClick:()=>setFieldTouched('proposeStakeRequired')})}),(0,jsx_runtime_1.jsxs)(GridItemCenter,{item:true,xs:7,container:true,direction:'row',justifyContent:'space-around',children:[(0,jsx_runtime_1.jsx)(core_1.Typography,{color:'textSecondary',children:((_a=orgSettings.governanceToken.tokenMetadata)===null||_a===void 0?void 0:_a.symbol)||''}),(0,jsx_runtime_1.jsx)(core_1.Tooltip,{placement:'bottom',title:`Amount of ${((_b=orgSettings.governanceToken.tokenMetadata)===null||_b===void 0?void 0:_b.symbol)||''} required to make a proposal. Total supply: ${(_c=orgSettings.governanceToken.tokenMetadata)===null||_c===void 0?void 0:_c.supply}`,children:(0,jsx_runtime_1.jsx)(InfoIconInput,{})})]})]})}),errors.proposeStakeRequired||errors.proposeStakePercentage?(0,jsx_runtime_1.jsx)(ErrorText,{children:errors.proposeStakeRequired||errors.proposeStakePercentage}):null]})]}),(0,jsx_runtime_1.jsxs)(SecondContainer,{container:true,direction:'row',children:[(0,jsx_runtime_1.jsx)(core_1.Typography,{style:styles.voting,variant:'subtitle1',color:'textSecondary',children:'Returned Stake After Proposal Rejection'}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,direction:'row',alignItems:'center',style:{marginTop:14},children:[(0,jsx_runtime_1.jsx)(GridNoPadding,{item:true,xs:8,sm:10,children:(0,jsx_runtime_1.jsx)(formik_1.Field,{name:'returnedTokenPercentage',children:()=>(0,jsx_runtime_1.jsx)(StyledSlider,{value:(0,formik_1.getIn)(values,'returnedTokenPercentage'),onChange:(value,newValue)=>setFieldValue('returnedTokenPercentage',newValue||0)})})}),(0,jsx_runtime_1.jsx)(GridNoPadding,{item:true,xs:4,sm:2,container:true,direction:'row',justifyContent:'flex-end',children:(0,jsx_runtime_1.jsx)(CustomSliderValue,{children:(0,jsx_runtime_1.jsxs)(Value,{variant:'subtitle1',color:'textSecondary',children:[(0,formik_1.getIn)(values,'returnedTokenPercentage'),'%']})})})]})]}),(0,jsx_runtime_1.jsx)(SpacingContainer,{direction:'row',container:true,alignItems:'center',children:(0,jsx_runtime_1.jsx)(core_1.Typography,{variant:'subtitle1',color:'textSecondary',children:'Min & Max Transfer Amounts'})}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,direction:'row',alignItems:'center',style:{marginTop:14},children:[(0,jsx_runtime_1.jsxs)(AdditionContainer,{item:true,xs:12,sm:4,children:[(0,jsx_runtime_1.jsxs)(ItemContainer,{container:true,direction:'row',alignItems:'center',justifyContent:'center',children:[(0,jsx_runtime_1.jsx)(GridItemCenter,{item:true,xs:5,children:(0,jsx_runtime_1.jsx)(formik_1.Field,{name:'minXtzAmount',type:'number',inputProps:{min:0.000001,defaultValue:0,step:0.01},placeholder:'00',component:formik_material_ui_1.TextField,onClick:()=>setFieldTouched('minXtzAmount')})}),(0,jsx_runtime_1.jsxs)(GridItemCenter,{item:true,xs:7,container:true,direction:'row',justifyContent:'space-around',children:[(0,jsx_runtime_1.jsx)(ValueText,{color:'textSecondary',children:'Min. XTZ'}),(0,jsx_runtime_1.jsx)(core_1.Tooltip,{placement:'bottom',title:'Minimum amount of XTZ that can be transferred',children:(0,jsx_runtime_1.jsx)(InfoIconInput,{})})]})]}),errors.minXtzAmount&&touched.minXtzAmount?(0,jsx_runtime_1.jsx)(ErrorText,{children:errors.minXtzAmount}):null]}),(0,jsx_runtime_1.jsxs)(AdditionContainer,{item:true,xs:12,sm:4,children:[(0,jsx_runtime_1.jsxs)(ItemContainer,{container:true,direction:'row',alignItems:'center',justifyContent:'center',children:[(0,jsx_runtime_1.jsx)(GridItemCenter,{item:true,xs:5,children:(0,jsx_runtime_1.jsx)(formik_1.Field,{name:'maxXtzAmount',type:'number',placeholder:'00',component:formik_material_ui_1.TextField,inputProps:{min:0.000001,defaultValue:0,step:0.01},onClick:()=>setFieldTouched('maxXtzAmount')})}),(0,jsx_runtime_1.jsxs)(GridItemCenter,{item:true,xs:7,container:true,direction:'row',justifyContent:'space-around',children:[(0,jsx_runtime_1.jsx)(ValueText,{color:'textSecondary',children:'Max. XTZ '}),(0,jsx_runtime_1.jsx)(core_1.Tooltip,{placement:'bottom',title:'Maximum amount of XTZ that can be transferred',children:(0,jsx_runtime_1.jsx)(InfoIconInput,{})})]})]}),errors.maxXtzAmount&&touched.maxXtzAmount?(0,jsx_runtime_1.jsx)(ErrorText,{children:errors.maxXtzAmount}):null]})]})]});};const Governance=()=>{const {dispatch,state,updateCache}=(0,react_1.useContext)(state_1.CreatorContext);const {votingSettings}=state.data;const history=(0,react_router_1.useHistory)();const saveStepInfo=(values,{setSubmitting})=>{const newState=Object.assign(Object.assign({},state.data),{votingSettings:values});updateCache(newState);setSubmitting(true);dispatch({type:state_1.ActionTypes.UPDATE_VOTING_SETTINGS,voting:values});history.push(`quorum`);};return(0,jsx_runtime_1.jsxs)(core_1.Box,{children:[(0,jsx_runtime_1.jsx)(TitleBlock_1.TitleBlock,{title:'Proposals & Voting',tooltipText:'Configure Proposals and Voting',tooltip:true,description:'These settings will define the duration, support and approval required for proposals.'}),(0,jsx_runtime_1.jsx)(formik_1.Formik,{enableReinitialize:true,validateOnChange:true,validateOnBlur:true,validate:validateForm,onSubmit:saveStepInfo,initialValues:votingSettings,children:({submitForm,isSubmitting,setFieldValue,values,errors,touched,setFieldTouched})=>{return(0,jsx_runtime_1.jsx)(formik_1.Form,{style:{width:'100%'},children:(0,jsx_runtime_1.jsx)(GovernanceForm,{submitForm:submitForm,isSubmitting:isSubmitting,setFieldValue:setFieldValue,errors:errors,touched:touched,values:values,setFieldTouched:setFieldTouched})});}})]});};exports.Governance=Governance;