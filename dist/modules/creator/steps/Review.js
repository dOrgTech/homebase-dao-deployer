'use strict';var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}function rejected(value){try{step(generator['throw'](value));}catch(e){reject(e);}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{'default':mod};};Object.defineProperty(exports,'__esModule',{value:true});exports.Review=void 0;const jsx_runtime_1=require('react/jsx-runtime');const react_1=require('react');const core_1=require('@material-ui/core');const react_router_dom_1=require('react-router-dom');const rocket_svg_1=__importDefault(require('../../../assets/img/rocket.svg'));const useOriginate_1=require('../../../services/contracts/baseDAO/hooks/useOriginate');const state_1=require('../state');const DeploymentLoader_1=require('../components/DeploymentLoader');const ProtectedRoute_1=require('../components/ProtectedRoute');const useTezos_1=require('../../../services/beacon/hooks/useTezos');const Toolbar_1=require('../../common/Toolbar');const RocketImg=(0,core_1.styled)('img')({marginBottom:46,height:128});const CustomButton=(0,core_1.styled)(core_1.Button)({marginTop:20});const CustomText=(0,core_1.styled)(core_1.Typography)({fontWeight:'bold',marginLeft:12,marginRight:12});const StyledContainer=(0,core_1.styled)(core_1.Box)({minHeight:500,minWidth:650,display:'grid',['@media (max-width:1167px)']:{minWidth:'auto'}});const Review=()=>{const {account,connect}=(0,useTezos_1.useTezos)();const validDAOData=(0,ProtectedRoute_1.useCreatorRouteValidation)();const {state,dispatch}=(0,react_1.useContext)(state_1.CreatorContext);const info=state.data;const {frozenToken,unfrozenToken}=(0,state_1.getTokensInfo)(info);const metadataCarrierParams=(0,react_1.useMemo)(()=>({keyName:'metadataKey',metadata:{frozenToken,unfrozenToken,description:info.orgSettings.description,authors:[info.orgSettings.administrator],template:state.data.template}}),[frozenToken,info.orgSettings.administrator,info.orgSettings.description,state.data.template,unfrozenToken]);const {mutation:{mutate,data,error},states,activeState}=(0,useOriginate_1.useOriginate)(state.data.template);const history=(0,react_router_dom_1.useHistory)();console.log('states: ',states);(0,react_1.useEffect)(()=>{;(()=>__awaiter(void 0,void 0,void 0,function*(){if(!validDAOData&&info&&metadataCarrierParams){mutate({metadataParams:metadataCarrierParams,params:info});}}))();},[]);(0,react_1.useEffect)(()=>{if(data&&data.address){dispatch({type:state_1.ActionTypes.CLEAR_CACHE});}},[data,dispatch]);return(0,jsx_runtime_1.jsx)(StyledContainer,{children:(0,jsx_runtime_1.jsx)(core_1.Grid,{container:true,direction:'row',justifyContent:'center',children:account?(0,jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment,{children:[(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,direction:'column',justifyContent:'center',alignItems:'center',style:{height:'fit-content'},children:[(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:(0,jsx_runtime_1.jsx)(RocketImg,{src:rocket_svg_1.default,alt:'rocket'})}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,container:true,direction:'row',justifyContent:'center',children:[(0,jsx_runtime_1.jsx)(core_1.Typography,{variant:'h4',color:'textSecondary',children:'Deploying'}),(0,jsx_runtime_1.jsxs)(CustomText,{color:'secondary',variant:'h4',children:[' ',state.data.orgSettings.name]}),(0,jsx_runtime_1.jsxs)(core_1.Typography,{variant:'h4',color:'textSecondary',children:[' ','to the Tezos Network']})]}),(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,xs:12,children:(0,jsx_runtime_1.jsx)(core_1.Box,{children:data&&data.address?(0,jsx_runtime_1.jsx)(CustomButton,{color:'secondary',variant:'outlined',onClick:()=>history.push('/explorer/dao/'+data.address),children:'Go to my DAO'}):null})})]}),(0,jsx_runtime_1.jsx)(DeploymentLoader_1.DeploymentLoader,{states:states,activeStep:activeState,error:error}),states[0].activeText!==''&&states[2].completedText===''&&error===null?(0,jsx_runtime_1.jsx)(core_1.Grid,{container:true,direction:'row',justifyContent:'center',alignContent:'center',children:(0,jsx_runtime_1.jsx)(core_1.Typography,{color:'secondary',children:' This may take several minutes '})}):null]}):(0,jsx_runtime_1.jsx)(Toolbar_1.ConnectWalletButton,{connect:connect})})});};exports.Review=Review;