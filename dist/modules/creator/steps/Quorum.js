'use strict';Object.defineProperty(exports,'__esModule',{value:true});exports.Quorum=void 0;const jsx_runtime_1=require('react/jsx-runtime');const core_1=require('@material-ui/core');const formik_material_ui_1=require('formik-material-ui');const react_1=require('react');const formik_1=require('formik');const react_router_1=require('react-router');const react_router_dom_1=require('react-router-dom');const state_1=require('../state');const icons_1=require('@material-ui/icons');const TitleBlock_1=require('../../common/TitleBlock');const utils_1=require('../utils');const ErrorText=(0,core_1.styled)(core_1.Typography)({display:'flex',minWidth:'100%',fontSize:14,color:'red'});const SpacingContainer=(0,core_1.styled)(core_1.Grid)({marginTop:25});const AdditionContainer=(0,core_1.styled)(core_1.Grid)(({theme})=>({marginTop:14,height:54,background:'#2F3438',borderRadius:8,maxWidth:150,['@media (max-width:1167px)']:{marginRight:0,maxWidth:'100%'}}));const GridItemCenter=(0,core_1.styled)(core_1.Grid)({textAlign:'center',justifyContent:'space-around',['@media (max-width:1167px)']:{justifyContent:'flex-end'}});const GridItemCenterBottom=(0,core_1.styled)(core_1.Grid)({textAlign:'center',justifyContent:'flex-end'});const ItemContainer=(0,core_1.styled)(core_1.Grid)(({theme})=>({height:'100%',padding:'12px 25px',['@media (max-width:1167px)']:{paddingLeft:25,paddingRight:25}}));const ValueText=(0,core_1.styled)(core_1.Typography)({fontSize:14,opacity:0.8,['@media (max-width:1167px)']:{marginRight:20}});const GridItemContainer=(0,core_1.styled)(core_1.Grid)(()=>({display:'flex',alignItems:'center'}));const InfoIconInput=(0,core_1.styled)(icons_1.InfoRounded)(({theme})=>({cursor:'default',color:theme.palette.secondary.light,height:16,width:16}));const InfoIconInputQuorum=(0,core_1.styled)(icons_1.InfoRounded)(({theme})=>({cursor:'default',color:theme.palette.secondary.light,height:16,width:16,marginTop:2}));const ParentContainer=(0,core_1.styled)(core_1.Grid)({marginTop:14,maxWidth:'70%',['@media (max-width:1167px)']:{maxWidth:'100%'}});const CustomInputContainer=(0,core_1.styled)(core_1.Grid)(({theme})=>({border:'none',height:54,marginTop:14,background:'#2F3438',borderRadius:8,alignItems:'center',justifyContent:'end',padding:'12px 25px',minWidth:150,maxWidth:150,['@media (max-width:1167px)']:{maxWidth:'100%',minWidth:'100%',paddingLeft:25,paddingRight:25}}));const InputContainer=(0,core_1.styled)(core_1.Grid)({paddingRight:15,['@media (max-width:1167px)']:{paddingRight:0}});const validateForm=values=>{const errors={};Object.keys(values).forEach(key=>{if(values[key]===''){errors[key]='Required';}if(Number(values[key])<0){errors[key]='Cannot be negative';}});if(values.minQuorumAmount<=0){errors.minQuorumAmount='Min Quorum amount must be greater than 0';}if(values.maxQuorumAmount>=100){errors.maxQuorumAmount='Max Quorum amount must be lower than 100';}if(values.minQuorumAmount>values.maxQuorumAmount){errors.maxQuorumAmount='Max Quorum amount must be greater than Min. Quorum amount';}if(values.quorumThreshold>=values.maxQuorumAmount||values.quorumThreshold<=values.minQuorumAmount){errors.quorumThreshold='Quorum Threshold must be between Min and Max Quorum amounts';}if(values.quorumChange>values.quorumMaxChange){errors.quorumChange='Cannot be greater than Max Quorum Change';}return errors;};const QuorumForm=({submitForm,values,errors,touched,setFieldValue,setFieldTouched})=>{var _a,_b;const {dispatch,state:{data:{orgSettings}}}=(0,react_1.useContext)(state_1.CreatorContext);const match=(0,react_router_dom_1.useRouteMatch)();const history=(0,react_router_1.useHistory)();(0,react_1.useEffect)(()=>{if(values){dispatch({type:state_1.ActionTypes.UPDATE_NAVIGATION_BAR,next:{text:'Continue',handler:()=>{submitForm(values);}},back:{text:'Back',handler:()=>history.push(`voting`)}});}},[dispatch,errors,history,match.path,match.url,submitForm,values]);return(0,jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment,{children:[(0,jsx_runtime_1.jsx)(SpacingContainer,{direction:'row',container:true,alignItems:'center',children:(0,jsx_runtime_1.jsx)(core_1.Typography,{variant:'subtitle1',color:'textSecondary',children:'Quorum Threshold'})}),(0,jsx_runtime_1.jsxs)(ParentContainer,{container:true,direction:'row',alignItems:'center',children:[(0,jsx_runtime_1.jsx)(InputContainer,{item:true,xs:12,sm:4,children:(0,jsx_runtime_1.jsx)(GridItemContainer,{children:(0,jsx_runtime_1.jsxs)(CustomInputContainer,{item:true,xs:12,container:true,direction:'row',children:[(0,jsx_runtime_1.jsx)(GridItemCenter,{item:true,xs:5,children:(0,jsx_runtime_1.jsx)(formik_1.Field,{name:'quorumThreshold',type:'number',onKeyDown:e=>(0,utils_1.handleChange)(e),placeholder:'00',inputProps:{min:0,max:100,step:1},component:formik_material_ui_1.TextField,InputProps:{endAdornment:(0,jsx_runtime_1.jsx)(ValueText,{color:'textSecondary',children:'%'})},onClick:()=>setFieldTouched('quorumThreshold')})}),(0,jsx_runtime_1.jsx)(GridItemCenterBottom,{item:true,xs:7,container:true,direction:'row',justifyContent:'flex-end',children:(0,jsx_runtime_1.jsx)(core_1.Tooltip,{placement:'bottom',title:`Initial % of ${((_a=orgSettings.governanceToken.tokenMetadata)===null||_a===void 0?void 0:_a.symbol)||''}'s supply required as votes to pass/reject a proposal. Total supply: ${(_b=orgSettings.governanceToken.tokenMetadata)===null||_b===void 0?void 0:_b.supply}`,children:(0,jsx_runtime_1.jsx)(InfoIconInput,{})})})]})})}),(0,jsx_runtime_1.jsx)(InputContainer,{item:true,xs:12,sm:4,children:(0,jsx_runtime_1.jsx)(GridItemContainer,{children:(0,jsx_runtime_1.jsxs)(CustomInputContainer,{item:true,xs:12,container:true,direction:'row',children:[(0,jsx_runtime_1.jsx)(GridItemCenter,{item:true,xs:5,children:(0,jsx_runtime_1.jsx)(formik_1.Field,{name:'minQuorumAmount',type:'number',onKeyDown:e=>(0,utils_1.handleChange)(e),placeholder:'00',inputProps:{min:0,max:100,step:1},component:formik_material_ui_1.TextField,InputProps:{endAdornment:(0,jsx_runtime_1.jsx)(ValueText,{color:'textSecondary',children:'%'})},onClick:()=>setFieldTouched('minQuorumAmount')})}),(0,jsx_runtime_1.jsxs)(GridItemCenter,{item:true,xs:7,container:true,direction:'row',justifyContent:'space-around',children:[(0,jsx_runtime_1.jsx)(ValueText,{color:'textSecondary',children:' Min'}),(0,jsx_runtime_1.jsx)(core_1.Tooltip,{placement:'bottom',title:'Minimum value the quorum can change to after participation adjustment',children:(0,jsx_runtime_1.jsx)(InfoIconInputQuorum,{})})]})]})})}),(0,jsx_runtime_1.jsx)(InputContainer,{item:true,xs:12,sm:4,children:(0,jsx_runtime_1.jsx)(GridItemContainer,{children:(0,jsx_runtime_1.jsxs)(CustomInputContainer,{item:true,xs:12,container:true,direction:'row',children:[(0,jsx_runtime_1.jsx)(GridItemCenter,{item:true,xs:5,children:(0,jsx_runtime_1.jsx)(formik_1.Field,{name:'maxQuorumAmount',type:'number',onKeyDown:e=>(0,utils_1.handleChange)(e),placeholder:'00',inputProps:{min:0,max:100,step:1},component:formik_material_ui_1.TextField,InputProps:{endAdornment:(0,jsx_runtime_1.jsx)(ValueText,{color:'textSecondary',children:'%'})},onClick:()=>setFieldTouched('maxQuorumAmount')})}),(0,jsx_runtime_1.jsxs)(GridItemCenter,{item:true,xs:7,container:true,direction:'row',children:[(0,jsx_runtime_1.jsx)(ValueText,{color:'textSecondary',children:'Max'}),(0,jsx_runtime_1.jsx)(core_1.Tooltip,{placement:'bottom',title:'Maximum value the quorum can change to after participation adjustment',children:(0,jsx_runtime_1.jsx)(InfoIconInputQuorum,{})})]})]})})}),errors.quorumThreshold&&touched.quorumThreshold?(0,jsx_runtime_1.jsx)(ErrorText,{children:errors.quorumThreshold}):null,errors.minQuorumAmount&&touched.minQuorumAmount?(0,jsx_runtime_1.jsx)(ErrorText,{children:errors.minQuorumAmount}):null,errors.maxQuorumAmount&&touched.maxQuorumAmount?(0,jsx_runtime_1.jsx)(ErrorText,{children:errors.maxQuorumAmount}):null]}),(0,jsx_runtime_1.jsx)(SpacingContainer,{direction:'row',container:true,alignItems:'center',children:(0,jsx_runtime_1.jsx)(core_1.Typography,{variant:'subtitle1',color:'textSecondary',children:'Quorum Change'})}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,direction:'row',alignItems:'center',style:{marginTop:14},children:[(0,jsx_runtime_1.jsx)(AdditionContainer,{item:true,xs:12,sm:3,children:(0,jsx_runtime_1.jsxs)(ItemContainer,{container:true,direction:'row',alignItems:'center',justifyContent:'center',children:[(0,jsx_runtime_1.jsx)(GridItemCenter,{item:true,xs:5,children:(0,jsx_runtime_1.jsx)(formik_1.Field,{name:'quorumChange',type:'number',onKeyDown:e=>(0,utils_1.handleChange)(e),placeholder:'00',inputProps:{min:0,max:100,step:1},component:formik_material_ui_1.TextField,InputProps:{endAdornment:(0,jsx_runtime_1.jsx)(ValueText,{color:'textSecondary',children:'%'})},onClick:()=>setFieldTouched('quorumChange')})}),(0,jsx_runtime_1.jsx)(GridItemCenterBottom,{item:true,xs:7,container:true,direction:'row',children:(0,jsx_runtime_1.jsx)(core_1.Tooltip,{placement:'bottom',title:'Participation adjustment value',children:(0,jsx_runtime_1.jsx)(InfoIconInput,{})})})]})}),errors.quorumChange&&touched.quorumChange?(0,jsx_runtime_1.jsx)(ErrorText,{children:errors.quorumChange}):null]}),(0,jsx_runtime_1.jsx)(SpacingContainer,{direction:'row',container:true,alignItems:'center',children:(0,jsx_runtime_1.jsx)(core_1.Typography,{variant:'subtitle1',color:'textSecondary',children:'Quorum Max Change'})}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,direction:'row',alignItems:'center',style:{marginTop:14},children:[(0,jsx_runtime_1.jsx)(AdditionContainer,{item:true,xs:12,sm:3,children:(0,jsx_runtime_1.jsxs)(ItemContainer,{container:true,direction:'row',alignItems:'center',justifyContent:'center',children:[(0,jsx_runtime_1.jsx)(GridItemCenter,{item:true,xs:5,children:(0,jsx_runtime_1.jsx)(formik_1.Field,{name:'quorumMaxChange',type:'number',onKeyDown:e=>(0,utils_1.handleChange)(e),placeholder:'00',inputProps:{min:0,max:100,step:1},component:formik_material_ui_1.TextField,InputProps:{endAdornment:(0,jsx_runtime_1.jsx)(ValueText,{color:'textSecondary',children:'%'})},onClick:()=>setFieldTouched('quorumMaxChange')})}),(0,jsx_runtime_1.jsx)(GridItemCenterBottom,{item:true,xs:7,container:true,direction:'row',justifyContent:'space-around',children:(0,jsx_runtime_1.jsx)(core_1.Tooltip,{placement:'bottom',title:'Maximum participation adjustment value',children:(0,jsx_runtime_1.jsx)(InfoIconInput,{})})})]})}),errors.quorumMaxChange&&touched.quorumMaxChange?(0,jsx_runtime_1.jsx)(ErrorText,{children:errors.quorumMaxChange}):null]})]});};const Quorum=()=>{const {dispatch,state,updateCache}=(0,react_1.useContext)(state_1.CreatorContext);const {quorumSettings}=state.data;const history=(0,react_router_1.useHistory)();const saveStepInfo=(values,{setSubmitting})=>{const newState=Object.assign(Object.assign({},state.data),{quorumSettings:values});updateCache(newState);setSubmitting(true);dispatch({type:state_1.ActionTypes.UPDATE_QUORUM_SETTINGS,quorum:values});history.push(`summary`);};return(0,jsx_runtime_1.jsxs)(core_1.Box,{children:[(0,jsx_runtime_1.jsx)(TitleBlock_1.TitleBlock,{title:'Quorum',description:`Each period, a new quorum threshold is calculated based on the previous`+'\''+'s period participation. It is set as a percentage of the governance token'+'\''+'s total supply',tooltipText:'Quorum Settings',tooltip:true}),(0,jsx_runtime_1.jsx)(formik_1.Formik,{enableReinitialize:true,validateOnChange:true,validateOnBlur:false,validate:values=>validateForm(values),onSubmit:saveStepInfo,initialValues:quorumSettings,children:({submitForm,isSubmitting,setFieldValue,values,errors,touched,setFieldTouched})=>{return(0,jsx_runtime_1.jsx)(formik_1.Form,{style:{width:'100%'},children:(0,jsx_runtime_1.jsx)(QuorumForm,{submitForm:submitForm,isSubmitting:isSubmitting,setFieldValue:setFieldValue,errors:errors,touched:touched,values:values,setFieldTouched:setFieldTouched})});}})]});};exports.Quorum=Quorum;