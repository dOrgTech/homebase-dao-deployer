'use strict';var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||('get'in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k];}};}Object.defineProperty(o,k2,desc);}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k];});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,'default',{enumerable:true,value:v});}:function(o,v){o['default']=v;});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=='default'&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result;};var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}function rejected(value){try{step(generator['throw'](value));}catch(e){reject(e);}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}step((generator=generator.apply(thisArg,_arguments||[])).next());});};Object.defineProperty(exports,'__esModule',{value:true});exports.VoteDetails=void 0;const jsx_runtime_1=require('react/jsx-runtime');const react_1=__importStar(require('react'));const core_1=require('@material-ui/core');const GridContainer_1=require('../../../common/GridContainer');const VotesDialog_1=require('./VotesDialog');const utils_1=require('../../../../services/lite/utils');const useTezos_1=require('../../../../services/beacon/hooks/useTezos');const useCommunityToken_1=require('../hooks/useCommunityToken');const Container=(0,core_1.styled)(core_1.Grid)(({theme})=>({background:theme.palette.primary.main,borderRadius:8}));const TitleContainer=(0,core_1.styled)(core_1.Grid)(({theme})=>({paddingTop:18,paddingLeft:46,paddingRight:46,paddingBottom:18,borderBottom:`0.3px solid ${theme.palette.primary.light}`,[theme.breakpoints.down('sm')]:{padding:'18px 25px'}}));const LinearContainer=(0,core_1.styled)(GridContainer_1.GridContainer)({paddingBottom:0,minHeight:110});const LegendContainer=(0,core_1.styled)(GridContainer_1.GridContainer)({minHeight:30,paddingBottom:0});const GraphicsContainer=(0,core_1.styled)(core_1.Grid)({paddingBottom:25});const VoteDetails=({poll,choices,token,communityId})=>{const theme=(0,core_1.useTheme)();const isMobileSmall=(0,core_1.useMediaQuery)(theme.breakpoints.down('xs'));const isMobile=(0,core_1.useMediaQuery)(theme.breakpoints.down('sm'));const [open,setOpen]=react_1.default.useState(false);const {network}=(0,useTezos_1.useTezos)();const [turnout,setTurnout]=(0,react_1.useState)(0);const [votes,setVotes]=(0,react_1.useState)([]);const tokenData=(0,useCommunityToken_1.useCommunityToken)(communityId);const handleClickOpen=()=>{setVotes(choices.filter(elem=>elem.walletAddresses.length>0));if(!isMobile){setOpen(true);}};const handleClose=()=>{setOpen(false);};(0,react_1.useMemo)(()=>__awaiter(void 0,void 0,void 0,function*(){if(token&&token!==undefined){const value=yield(0,utils_1.getTurnoutValue)(network,token,Number(poll===null||poll===void 0?void 0:poll.referenceBlock),(0,utils_1.getTotalVoters)(choices));setTurnout(value);}}),[poll,choices,network,token]);return(0,jsx_runtime_1.jsxs)(Container,{container:true,direction:'column',children:[(0,jsx_runtime_1.jsx)(TitleContainer,{item:true,children:(0,jsx_runtime_1.jsx)(core_1.Typography,{variant:'body2',color:'textPrimary',children:'Results'})}),(0,jsx_runtime_1.jsxs)(GraphicsContainer,{container:true,children:[choices&&choices.map((choice,index)=>(0,jsx_runtime_1.jsxs)(LinearContainer,{container:true,direction:'column',style:{gap:20},children:[(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,container:true,direction:'row',alignItems:'center',children:[(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,xs:12,lg:6,sm:6,children:(0,jsx_runtime_1.jsx)(core_1.Typography,{color:'textPrimary',variant:'body2',children:choice.name})}),(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,xs:12,lg:6,sm:6,container:true,justifyContent:isMobileSmall?'flex-start':'flex-end',children:choice&&choice.walletAddresses?(0,jsx_runtime_1.jsxs)(core_1.Typography,{color:'textPrimary',variant:'body2',children:[choice.walletAddresses.length,' Voters -',' ',(0,utils_1.nFormatter)((0,utils_1.calculateChoiceTotal)(choice.walletAddresses,tokenData===null||tokenData===void 0?void 0:tokenData.decimals),1),' ',tokenData===null||tokenData===void 0?void 0:tokenData.symbol]}):null})]}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,container:true,direction:'row',alignItems:'center',children:[(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,xs:10,lg:11,sm:11,children:(0,jsx_runtime_1.jsx)(core_1.LinearProgress,{style:{width:'100%',marginRight:'4px'},color:'secondary',value:(0,utils_1.calculateWeight)(poll===null||poll===void 0?void 0:poll.totalSupplyAtReferenceBlock,(0,utils_1.calculateChoiceTotal)(choice.walletAddresses,tokenData===null||tokenData===void 0?void 0:tokenData.decimals),tokenData===null||tokenData===void 0?void 0:tokenData.decimals).dp(2,1).toNumber(),variant:'determinate'})}),(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,xs:2,lg:1,sm:1,container:true,justifyContent:'flex-end',children:(0,jsx_runtime_1.jsxs)(core_1.Typography,{color:'textPrimary',variant:'body2',children:[(0,utils_1.calculateWeight)(poll===null||poll===void 0?void 0:poll.totalSupplyAtReferenceBlock,(0,utils_1.calculateChoiceTotal)(choice.walletAddresses,tokenData===null||tokenData===void 0?void 0:tokenData.decimals),tokenData===null||tokenData===void 0?void 0:tokenData.decimals).dp(2,1).toString(),'%']})})]})]},`'option-'${index}`)),(0,jsx_runtime_1.jsxs)(LegendContainer,{container:true,direction:'row',children:[(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,container:true,direction:'row',xs:12,sm:6,md:6,lg:6,style:{gap:10},children:[(0,jsx_runtime_1.jsx)(core_1.Typography,{color:'secondary',variant:'body1',onClick:()=>handleClickOpen(),children:(0,utils_1.getTotalVoters)(choices)}),(0,jsx_runtime_1.jsx)(core_1.Typography,{color:'textPrimary',variant:'body1',children:'Votes'}),(0,jsx_runtime_1.jsxs)(core_1.Typography,{color:'textPrimary',variant:'body2',children:['(',turnout.toFixed(2),' % Turnout)']})]}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,container:true,direction:'row',xs:12,md:6,sm:6,lg:6,style:{gap:10},justifyContent:isMobileSmall?'flex-start':'flex-end',children:[(0,jsx_runtime_1.jsx)(core_1.Typography,{color:'textPrimary',variant:'body1',children:(0,utils_1.nFormatter)((0,utils_1.calculateProposalTotal)(choices,tokenData===null||tokenData===void 0?void 0:tokenData.decimals),1)}),(0,jsx_runtime_1.jsx)(core_1.Typography,{color:'textPrimary',variant:'body1',children:poll===null||poll===void 0?void 0:poll.tokenSymbol}),(0,jsx_runtime_1.jsxs)(core_1.Typography,{color:'textPrimary',variant:'body2',children:['(',(0,utils_1.getTreasuryPercentage)((0,utils_1.calculateProposalTotal)(choices,tokenData===null||tokenData===void 0?void 0:tokenData.decimals),poll===null||poll===void 0?void 0:poll.totalSupplyAtReferenceBlock,tokenData===null||tokenData===void 0?void 0:tokenData.decimals).dp(5,1).toString(),'% of Total Supply)']})]})]}),(0,jsx_runtime_1.jsx)(VotesDialog_1.VotesDialog,{decimals:(tokenData===null||tokenData===void 0?void 0:tokenData.decimals)?tokenData===null||tokenData===void 0?void 0:tokenData.decimals:'',symbol:(tokenData===null||tokenData===void 0?void 0:tokenData.symbol)?tokenData===null||tokenData===void 0?void 0:tokenData.symbol:'',choices:votes,open:open,handleClose:handleClose})]})]});};exports.VoteDetails=VoteDetails;