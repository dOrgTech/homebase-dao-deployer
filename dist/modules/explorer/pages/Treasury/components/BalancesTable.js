'use strict';var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{'default':mod};};Object.defineProperty(exports,'__esModule',{value:true});exports.BalancesTable=void 0;const jsx_runtime_1=require('react/jsx-runtime');const react_1=require('react');const core_1=require('@material-ui/core');const ProposalForm_1=require('../../../components/ProposalForm');const useDAOHoldings_1=require('../../../../../services/contracts/baseDAO/hooks/useDAOHoldings');const useTezosBalance_1=require('../../../../../services/contracts/baseDAO/hooks/useTezosBalance');const router_1=require('../../DAO/router');const bignumber_js_1=__importDefault(require('bignumber.js'));const useCycleInfo_1=require('../../../../../services/contracts/baseDAO/hooks/useCycleInfo');const SmallButton_1=require('../../../../common/SmallButton');const utils_1=require('../../../../../services/contracts/utils');const CopyButton_1=require('../../../../common/CopyButton');const TokenSymbol=(0,core_1.styled)(core_1.Typography)(({theme})=>({color:theme.palette.secondary.main,boxSizing:'border-box',width:'min-content',fontSize:24}));const MobileTableHeader=(0,core_1.styled)(core_1.Grid)({width:'100%',padding:20,borderBottom:'0.3px solid #3D3D3D'});const MobileTableRow=(0,core_1.styled)(core_1.Grid)({padding:'30px',borderBottom:'0.3px solid #3D3D3D'});const AddressText=(0,core_1.styled)(core_1.Typography)({marginTop:8});const TokenCard=(0,core_1.styled)(core_1.Card)(({theme})=>({height:200,background:theme.palette.primary.main,borderRadius:8,padding:'32px 36px'}));const CustomCardContent=(0,core_1.styled)(core_1.CardContent)({padding:0});const BalanceText=(0,core_1.styled)(core_1.Typography)(({theme})=>({fontSize:24,fontWeight:300,marginBottom:16,[theme.breakpoints.down('sm')]:{fontSize:'24px !important'}}));const BalanceTitle=(0,core_1.styled)(core_1.Typography)(({theme})=>({fontSize:18,[theme.breakpoints.down('sm')]:{fontSize:'18px !important'}}));const createData=daoHolding=>{return{symbol:daoHolding.token.symbol,address:daoHolding.token.contract,amount:daoHolding.balance.dp(10,1).toString()};};const titles=['Token Balances','Address','Balance'];const titleDataMatcher=(title,rowData)=>{switch(title){case'Token Balances':return rowData.symbol;case'Address':return rowData.address;case'Balance':return rowData.amount;}};const BalancesList=({rows,tezosBalance,openTokenTransferModal,openXTZTransferModal,shouldDisable,isMobileSmall})=>{return(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,direction:'row',spacing:2,children:[(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,xs:isMobileSmall?12:3,children:(0,jsx_runtime_1.jsx)(TokenCard,{children:(0,jsx_runtime_1.jsxs)(CustomCardContent,{children:[(0,jsx_runtime_1.jsx)(TokenSymbol,{children:'XTZ'}),(0,jsx_runtime_1.jsx)(BalanceTitle,{variant:'body1',color:'secondary',style:{marginTop:49},children:'Balance'}),(0,jsx_runtime_1.jsx)(BalanceText,{children:tezosBalance.toString()}),(0,jsx_runtime_1.jsx)(core_1.Grid,{container:true,item:true,direction:'row',alignItems:'center',justifyContent:'center',children:(0,jsx_runtime_1.jsx)(SmallButton_1.SmallButton,{variant:'contained',color:'secondary',onClick:()=>openXTZTransferModal(),disabled:shouldDisable,children:'Transfer'})})]})})}),rows.map((row,i)=>(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,xs:isMobileSmall?12:3,children:(0,jsx_runtime_1.jsx)(TokenCard,{children:(0,jsx_runtime_1.jsxs)(CustomCardContent,{children:[(0,jsx_runtime_1.jsx)(TokenSymbol,{children:row.symbol}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,item:true,direction:'row',alignItems:'center',children:[(0,jsx_runtime_1.jsx)(AddressText,{variant:'subtitle2',children:(0,utils_1.toShortAddress)(row.address)}),(0,jsx_runtime_1.jsx)(CopyButton_1.CopyButton,{text:row.address,style:{height:15}})]}),(0,jsx_runtime_1.jsx)(BalanceTitle,{color:'secondary',style:{marginTop:16},children:'Balance'}),(0,jsx_runtime_1.jsx)(BalanceText,{children:row.amount}),(0,jsx_runtime_1.jsx)(core_1.Grid,{container:true,item:true,direction:'row',alignItems:'center',justifyContent:'center',children:(0,jsx_runtime_1.jsx)(SmallButton_1.SmallButton,{variant:'contained',color:'secondary',onClick:()=>openTokenTransferModal(row.address),disabled:shouldDisable,children:'Transfer'})})]})})},`token-`+i))]});};const BalancesTable=()=>{const theme=(0,core_1.useTheme)();const isSmall=(0,core_1.useMediaQuery)(theme.breakpoints.down('sm'));const daoId=(0,router_1.useDAOID)();const shouldDisable=(0,useCycleInfo_1.useIsProposalButtonDisabled)(daoId);const {tokenHoldings}=(0,useDAOHoldings_1.useDAOHoldings)(daoId);const {data:tezosBalance}=(0,useTezosBalance_1.useTezosBalance)(daoId);const [openTransfer,setOpenTransfer]=(0,react_1.useState)(false);const [defaultValues,setDefaultValues]=(0,react_1.useState)();const onCloseTransfer=()=>{setOpenTransfer(false);setDefaultValues(undefined);};const onOpenXTZTransferModal=()=>{setDefaultValues({transferForm:{isBatch:false,transfers:[{recipient:'',amount:1,asset:{symbol:'XTZ'}}]}});setOpenTransfer(true);};const onOpenTokenTransferModal=tokenAddress=>{const selectedToken=tokenHoldings.find(holding=>holding.token.contract.toLowerCase()===tokenAddress.toLowerCase());setDefaultValues({transferForm:{transfers:[{recipient:'',amount:1,asset:selectedToken.token}]}});setOpenTransfer(true);};const rows=(0,react_1.useMemo)(()=>{if(!tokenHoldings){return[];}return tokenHoldings.map(createData);},[tokenHoldings]);return(0,jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment,{children:[(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:(0,jsx_runtime_1.jsx)(BalancesList,{rows:rows,tezosBalance:tezosBalance||new bignumber_js_1.default(0),openTokenTransferModal:onOpenTokenTransferModal,openXTZTransferModal:onOpenXTZTransferModal,shouldDisable:shouldDisable,isMobileSmall:isSmall})}),(0,jsx_runtime_1.jsx)(ProposalForm_1.ProposalFormContainer,{open:openTransfer,handleClose:onCloseTransfer,defaultValues:defaultValues,defaultTab:0})]});};exports.BalancesTable=BalancesTable;