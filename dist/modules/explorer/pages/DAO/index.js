'use strict';var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{'default':mod};};Object.defineProperty(exports,'__esModule',{value:true});exports.DAO=exports.StyledAvatar=void 0;const jsx_runtime_1=require('react/jsx-runtime');const react_1=require('react');const core_1=require('@material-ui/core');const useFlush_1=require('../../../../services/contracts/baseDAO/hooks/useFlush');const useDAO_1=require('../../../../services/services/dao/hooks/useDAO');const useProposals_1=require('../../../../services/services/dao/hooks/useProposals');const router_1=require('./router');const ContentContainer_1=require('../../components/ContentContainer');const ProposalsList_1=require('../../components/ProposalsList');const types_1=require('../../../../services/services/dao/mappers/proposal/types');const DAOStatsRow_1=require('../../components/DAOStatsRow');const UsersTable_1=require('../../components/UsersTable');const bignumber_js_1=__importDefault(require('bignumber.js'));const usePolls_1=require('../../../lite/explorer/hooks/usePolls');const dayjs_1=__importDefault(require('dayjs'));const Settings_1=require('./components/Settings');const icons_1=require('@material-ui/icons');exports.StyledAvatar=(0,core_1.styled)(core_1.Avatar)({height:50,width:50});const HeroContainer=(0,core_1.styled)(ContentContainer_1.ContentContainer)(({theme})=>({padding:'38px 38px'}));const TitleText=(0,core_1.styled)(core_1.Typography)(({theme})=>({fontSize:40,fontWeight:500,lineHeight:0.8,['@media (max-width:642px)']:{fontSize:35},['@media (max-width:583px)']:{fontSize:30},['@media (max-width:533px)']:{fontSize:25},['@media (max-width:462px)']:{fontSize:22}}));const ViewSettings=(0,core_1.styled)(core_1.Grid)({'fontWeight':300,'gap':8,'cursor':'pointer','& h6':{fontWeight:300}});const SubtitleText=(0,core_1.styled)(core_1.Typography)({fontSize:18,margin:'-10px auto 0 auto',width:'875px',fontWeight:300,maxHeight:'200px',overflowY:'scroll',['@media (max-width:1166px)']:{width:'75.3vw'},['@media (max-width:1138px)']:{width:'100%'},['@media (max-width:599.98px)']:{width:'100%',margin:'-15px auto 0 auto'}});const TableContainer=(0,core_1.styled)(ContentContainer_1.ContentContainer)({width:'100%'});const DAO=()=>{var _a;const daoId=(0,router_1.useDAOID)();const {data,cycleInfo,ledger}=(0,useDAO_1.useDAO)(daoId);const {mutate}=(0,useFlush_1.useFlush)();const theme=(0,core_1.useTheme)();const isExtraSmall=(0,core_1.useMediaQuery)(theme.breakpoints.down('xs'));const name=data&&data.data.name;const description=data&&data.data.description;const {data:activeProposals}=(0,useProposals_1.useProposals)(daoId,types_1.ProposalStatus.ACTIVE);const {data:executableProposals}=(0,useProposals_1.useProposals)(daoId,types_1.ProposalStatus.EXECUTABLE);const {data:expiredProposals}=(0,useProposals_1.useProposals)(daoId,types_1.ProposalStatus.EXPIRED);const polls=(0,usePolls_1.usePolls)((_a=data===null||data===void 0?void 0:data.liteDAOData)===null||_a===void 0?void 0:_a._id);const activeLiteProposals=polls===null||polls===void 0?void 0:polls.filter(p=>Number(p.endTime)>(0,dayjs_1.default)().valueOf());const [openDialog,setOpenDialog]=(0,react_1.useState)(false);const handleCloseModal=()=>{setOpenDialog(false);};const usersTableData=(0,react_1.useMemo)(()=>{if(!ledger||!cycleInfo||!data){return[];}return ledger.sort((a,b)=>b.available_balance.minus(a.available_balance).toNumber()).map(p=>({address:p.holder.address,totalStaked:new bignumber_js_1.default(p.total_balance).dp(10,1).toString(),availableStaked:new bignumber_js_1.default(p.available_balance).dp(10,1).toString(),votes:p.holder.votes_cast.toString(),proposalsVoted:p.holder.proposals_voted.toString()}));},[cycleInfo,data,ledger]);return(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,direction:'column',style:{gap:isExtraSmall?25:42},children:[(0,jsx_runtime_1.jsx)(HeroContainer,{item:true,children:(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,direction:'column',style:{gap:36},children:[(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,style:{gap:20},alignItems:'center',children:[(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:(0,jsx_runtime_1.jsx)(TitleText,{color:'textPrimary',children:name})}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,children:[(0,jsx_runtime_1.jsxs)(ViewSettings,{container:true,direction:'row',alignItems:'center',onClick:()=>setOpenDialog(true),children:[(0,jsx_runtime_1.jsx)(icons_1.Visibility,{fontSize:'small',color:'secondary'}),(0,jsx_runtime_1.jsx)(core_1.Typography,{variant:'h6',color:'secondary',children:'View configuration'})]}),(0,jsx_runtime_1.jsx)(Settings_1.DaoSettingModal,{open:openDialog,handleClose:handleCloseModal})]})]})}),(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:(0,jsx_runtime_1.jsx)(SubtitleText,{color:'textPrimary',children:description})})]})}),(0,jsx_runtime_1.jsx)(DAOStatsRow_1.DAOStatsRow,{}),data&&cycleInfo&&activeProposals&&(0,jsx_runtime_1.jsx)(jsx_runtime_1.Fragment,{children:(0,jsx_runtime_1.jsx)(ProposalsList_1.ProposalsList,{showFooter:true,title:'Active Proposals',currentLevel:cycleInfo.currentLevel,proposals:activeProposals,liteProposals:activeLiteProposals})}),(0,jsx_runtime_1.jsx)(TableContainer,{item:true,children:(0,jsx_runtime_1.jsx)(UsersTable_1.UsersTable,{data:usersTableData})})]});};exports.DAO=DAO;