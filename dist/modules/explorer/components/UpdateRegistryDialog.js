'use strict';var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||('get'in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k];}};}Object.defineProperty(o,k2,desc);}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k];});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,'default',{enumerable:true,value:v});}:function(o,v){o['default']=v;});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=='default'&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result;};Object.defineProperty(exports,'__esModule',{value:true});exports.UpdateRegistryDialog=exports.updateRegistryFormSchema=exports.registryProposalFormInitialState=void 0;const jsx_runtime_1=require('react/jsx-runtime');const react_1=__importStar(require('react'));const core_1=require('@material-ui/core');const ErrorText_1=require('./styled/ErrorText');const Yup=__importStar(require('yup'));const react_hook_form_1=require('react-hook-form');const BatchBar_1=require('./BatchBar');const ProposalFormInput_1=require('./ProposalFormInput');const emptyItem={key:'',value:''};const TextArea=(0,core_1.styled)(core_1.TextField)({'& .MuiInputBase-input':{textAlign:'left',paddingTop:6}});exports.registryProposalFormInitialState={registryUpdateForm:{list:[emptyItem],isBatch:false}};exports.updateRegistryFormSchema=Yup.object().shape({registryUpdateForm:Yup.object().shape({list:Yup.array().of(Yup.object().shape({key:Yup.string().required('Required')}))})});const UpdateRegistryDialog=({open})=>{var _a,_b,_c,_d,_e,_f;const [activeItem,setActiveItem]=react_1.default.useState(1);const {control,getValues,setValue,reset,formState:{errors,touchedFields:touched}}=(0,react_hook_form_1.useFormContext)();const {fields,append}=(0,react_hook_form_1.useFieldArray)({control,name:'registryUpdateForm.list'});const values=getValues();const [isBatch,setIsBatch]=(0,react_1.useState)(values.registryUpdateForm.isBatch);const handleIsBatchChange=()=>{setIsBatch(!isBatch);setValue('registryUpdateForm.isBatch',!isBatch);setActiveItem(1);};const keyError=(_c=(_b=(_a=errors===null||errors===void 0?void 0:errors.registryUpdateForm)===null||_a===void 0?void 0:_a.list)===null||_b===void 0?void 0:_b[activeItem-1])===null||_c===void 0?void 0:_c.key;const valueError=(_f=(_e=(_d=errors===null||errors===void 0?void 0:errors.registryUpdateForm)===null||_d===void 0?void 0:_d.list)===null||_e===void 0?void 0:_e[activeItem-1])===null||_f===void 0?void 0:_f.value;(0,react_1.useMemo)(()=>{if(!open){reset();}},[open,reset]);return(0,jsx_runtime_1.jsx)(core_1.DialogContent,{children:(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,direction:'column',style:{gap:31},children:[(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:(0,jsx_runtime_1.jsx)(BatchBar_1.BatchBar,{isBatch:isBatch,stateIsBatch:values.registryUpdateForm.isBatch,handleIsBatchChange:handleIsBatchChange,onClickAdd:()=>{append(emptyItem);setActiveItem(activeItem+1);},items:values.registryUpdateForm.list,activeItem:activeItem,setActiveItem:index=>setActiveItem(index+1)})}),fields.map((field,index)=>{var _a,_b,_c,_d,_e,_f;return index===activeItem-1&&(0,jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment,{children:[(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:(0,jsx_runtime_1.jsxs)(ProposalFormInput_1.ProposalFormInput,{label:'Key',children:[(0,jsx_runtime_1.jsx)(react_hook_form_1.Controller,{name:`registryUpdateForm.list.${activeItem-1}.key`,control:control,render:({field})=>(0,jsx_runtime_1.jsx)(core_1.TextField,Object.assign({},field,{type:'string',InputProps:{disableUnderline:true},placeholder:'Type a Key'}))},field.id),keyError&&((_c=(_b=(_a=touched.registryUpdateForm)===null||_a===void 0?void 0:_a.list)===null||_b===void 0?void 0:_b[activeItem-1])===null||_c===void 0?void 0:_c.key)?(0,jsx_runtime_1.jsx)(ErrorText_1.ErrorText,{children:keyError}):null]})}),(0,jsx_runtime_1.jsx)(core_1.Grid,{children:(0,jsx_runtime_1.jsxs)(ProposalFormInput_1.ProposalFormInput,{label:'Value',children:[(0,jsx_runtime_1.jsx)(react_hook_form_1.Controller,{name:`registryUpdateForm.list.${activeItem-1}.value`,control:control,render:({field})=>(0,jsx_runtime_1.jsx)(TextArea,Object.assign({},field,{multiline:true,type:'string',rows:6,placeholder:'Type a value',InputProps:{disableUnderline:true}}))},field.id),valueError&&((_f=(_e=(_d=touched.registryUpdateForm)===null||_d===void 0?void 0:_d.list)===null||_e===void 0?void 0:_e[activeItem-1])===null||_f===void 0?void 0:_f.value)?(0,jsx_runtime_1.jsx)(ErrorText_1.ErrorText,{children:valueError}):null]})})]});})]})});};exports.UpdateRegistryDialog=UpdateRegistryDialog;