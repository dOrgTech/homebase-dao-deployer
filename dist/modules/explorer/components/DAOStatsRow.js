'use strict';var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{'default':mod};};Object.defineProperty(exports,'__esModule',{value:true});exports.DAOStatsRow=void 0;const jsx_runtime_1=require('react/jsx-runtime');const react_1=require('react');const votingPeriod_svg_1=require('../../../assets/logos/votingPeriod.svg');const react_customizable_progressbar_1=__importDefault(require('react-customizable-progressbar'));const core_1=require('@material-ui/core');const ContentContainer_1=require('./ContentContainer');const CycleDescription_1=require('./CycleDescription');const useDAO_1=require('../../../services/services/dao/hooks/useDAO');const useProposals_1=require('../../../services/services/dao/hooks/useProposals');const bignumber_js_1=__importDefault(require('bignumber.js'));const types_1=require('../../../services/services/dao/mappers/proposal/types');const router_1=require('../pages/DAO/router');const useTimeLeftInCycle_1=require('../hooks/useTimeLeftInCycle');const usePolls_1=require('../../lite/explorer/hooks/usePolls');const dayjs_1=__importDefault(require('dayjs'));const StatsContainer=(0,core_1.styled)(ContentContainer_1.ContentContainer)(({theme})=>({padding:'38px 38px',maxHeight:'310px',['@media (max-width:1030px)']:{maxHeight:'303px'},['@media (max-width:831px)']:{minWidth:'99%'},['@media (max-width:390px)']:{maxHeight:'340px'}}));const LockedTokensBar=(0,core_1.styled)(core_1.LinearProgress)(({theme})=>({'width':'100%','height':'8px','marginTop':'15px','marginBottom':'43px','&.MuiLinearProgress-colorSecondary':{background:theme.palette.primary.light},['@media (max-width:1030px)']:{marginTop:'13px',marginBottom:'40px'}}));const IconContainer=(0,core_1.styled)(core_1.SvgIcon)({width:'auto',height:64});const ProgressContainer=(0,core_1.styled)(core_1.Box)({marginLeft:'-18px',marginTop:'-20px',marginBottom:'-5px'});const ProposalInfoTitle=(0,core_1.styled)(core_1.Typography)({fontSize:'18px',['@media (max-width:1155px)']:{whiteSpace:'nowrap'},['@media (max-width:1030px)']:{fontSize:'16.3px',whiteSpace:'initial'},['@media (max-width:830.99px)']:{fontSize:'18px'},['@media (max-width:409.99px)']:{fontSize:'16px'}});const LargeNumber=(0,core_1.styled)(core_1.Typography)(({theme})=>({fontSize:'36px',fontWeight:300,color:theme.palette.text.primary,marginTop:'7px',['@media (max-width:1030px)']:{fontSize:'30px'}}));const CycleTime=(0,core_1.styled)(core_1.Typography)(({theme})=>({fontWeight:300,color:theme.palette.text.primary,fontSize:'20px',['@media (max-width:1030px)']:{fontSize:'16px'},['@media (max-width:830.99px)']:{fontSize:'20px'},['@media (max-width:434px)']:{fontSize:'18px'},['@media (max-width:409.99px)']:{fontSize:'15px'}}));const DAOStatsRow=()=>{var _a;const daoId=(0,router_1.useDAOID)();const {data,cycleInfo,ledger}=(0,useDAO_1.useDAO)(daoId);const symbol=data&&data.data.token.symbol.toUpperCase();const blocksLeft=cycleInfo&&cycleInfo.blocksLeft;const theme=(0,core_1.useTheme)();const isExtraSmall=(0,core_1.useMediaQuery)(theme.breakpoints.down('xs'));const {data:activeProposals}=(0,useProposals_1.useProposals)(daoId,types_1.ProposalStatus.ACTIVE);const {hours,minutes,days}=(0,useTimeLeftInCycle_1.useTimeLeftInCycle)();const polls=(0,usePolls_1.usePolls)((_a=data===null||data===void 0?void 0:data.liteDAOData)===null||_a===void 0?void 0:_a._id);const activeLiteProposals=polls===null||polls===void 0?void 0:polls.filter(p=>Number(p.endTime)>(0,dayjs_1.default)().valueOf());const amountLocked=(0,react_1.useMemo)(()=>{if(!ledger){return new bignumber_js_1.default(0);}return ledger.reduce((acc,current)=>{const frozenBalance=new bignumber_js_1.default(current.total_balance)||new bignumber_js_1.default(0);return acc.plus(frozenBalance);},new bignumber_js_1.default(0));},[ledger]);const amountNotLocked=(0,react_1.useMemo)(()=>{if(!data){return new bignumber_js_1.default(0);}return data.data.token.supply;},[data]);const totalTokens=amountLocked.plus(amountNotLocked);const amountLockedPercentage=totalTokens?amountLocked.div(totalTokens).multipliedBy(100):new bignumber_js_1.default(0);return(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,style:{gap:isExtraSmall?25:44},children:[(0,jsx_runtime_1.jsx)(StatsContainer,{item:true,xs:true,children:(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,direction:'column',style:{gap:24,marginTop:'-3px'},children:[(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:(0,jsx_runtime_1.jsx)(CycleDescription_1.CycleDescription,{daoAddress:daoId})}),(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,wrap:'nowrap',children:[(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:(0,jsx_runtime_1.jsx)(ProgressContainer,{children:(0,jsx_runtime_1.jsx)(react_customizable_progressbar_1.default,{progress:data?(blocksLeft||0)/Number(data.data.period)*100:100,radius:35,strokeWidth:6,strokeColor:theme.palette.secondary.main,trackStrokeWidth:5,trackStrokeColor:'rgba(125,140,139, 0.2)'})})}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,children:[(0,jsx_runtime_1.jsx)(ProposalInfoTitle,{color:'secondary',children:'Current Cycle'}),(0,jsx_runtime_1.jsx)(CycleTime,{color:'textPrimary',children:cycleInfo===null||cycleInfo===void 0?void 0:cycleInfo.currentCycle})]})]})}),(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,style:{gap:28},wrap:'nowrap',children:[(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:(0,jsx_runtime_1.jsx)(IconContainer,{children:(0,jsx_runtime_1.jsx)(votingPeriod_svg_1.ReactComponent,{})})}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,children:[(0,jsx_runtime_1.jsx)(ProposalInfoTitle,{color:'secondary',style:{marginTop:'-6px'},children:'Time Left In Cycle'}),(0,jsx_runtime_1.jsxs)(CycleTime,{children:[days,'d ',hours,'h ',minutes,'m (',cycleInfo===null||cycleInfo===void 0?void 0:cycleInfo.blocksLeft,' blocks)']})]})]})})]})}),(0,jsx_runtime_1.jsx)(StatsContainer,{item:true,xs:true,children:(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,direction:'column',style:{marginTop:'-3px'},children:[(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,direction:'column',children:[(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:(0,jsx_runtime_1.jsxs)(ProposalInfoTitle,{color:'secondary',children:[symbol,' Locked']})}),(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:(0,jsx_runtime_1.jsx)(LargeNumber,{children:amountLocked.dp(10,1).toString()})}),(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:(0,jsx_runtime_1.jsx)(LockedTokensBar,{variant:'determinate',value:amountLockedPercentage.toNumber(),color:'secondary'})})]})}),(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,style:{gap:isExtraSmall?10:50},wrap:'nowrap',justifyContent:isExtraSmall?'space-between':'flex-start',children:[(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,children:[(0,jsx_runtime_1.jsx)(ProposalInfoTitle,{color:'secondary',children:'Voting Addresses'}),(0,jsx_runtime_1.jsx)(LargeNumber,{children:(data===null||data===void 0?void 0:data.data.ledger.length)||'-'})]}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,children:[(0,jsx_runtime_1.jsx)(ProposalInfoTitle,{color:'secondary',children:'Active Proposals'}),(0,jsx_runtime_1.jsx)(LargeNumber,{color:'textPrimary',children:Number(activeProposals===null||activeProposals===void 0?void 0:activeProposals.length)+Number(activeLiteProposals.length)})]})]})})]})})]})});};exports.DAOStatsRow=DAOStatsRow;