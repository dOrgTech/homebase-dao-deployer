'use strict';var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||('get'in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k];}};}Object.defineProperty(o,k2,desc);}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k];});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,'default',{enumerable:true,value:v});}:function(o,v){o['default']=v;});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=='default'&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result;};Object.defineProperty(exports,'__esModule',{value:true});exports.UpVotesDialog=void 0;const jsx_runtime_1=require('react/jsx-runtime');const react_1=__importStar(require('react'));const core_1=require('@material-ui/core');const ProgressBar_1=require('./ProgressBar');const useVotesStats_1=require('../hooks/useVotesStats');const VotersProgress_1=require('./VotersProgress');const AppTabBar_1=require('./AppTabBar');const TabPanel_1=require('./TabPanel');const bignumber_js_1=require('bignumber.js');const useProposal_1=require('../../../services/services/dao/hooks/useProposal');const UserBadge_1=require('./UserBadge');const ResponsiveDialog_1=require('./ResponsiveDialog');const CloseButton=(0,core_1.styled)(core_1.Typography)({fontWeight:900,cursor:'pointer'});const Title=(0,core_1.styled)(core_1.DialogTitle)({height:30,paddingBottom:0,minWidth:250});const CustomDialog=(0,core_1.styled)(ResponsiveDialog_1.ResponsiveDialog)({'& .MuiDialog-paperWidthSm':{minHeight:'400px !important',maxHeight:600}});const StyledViewButton=(0,core_1.styled)(core_1.Button)({marginTop:-30});const TextHeader=(0,core_1.styled)(core_1.Typography)({marginTop:10,marginBottom:10});const Row=(0,core_1.styled)(core_1.Grid)(({theme})=>({'padding':'33px 64px','borderTop':`2px solid ${theme.palette.primary.light}`,'paddingBottom':0,'display':'flex','alignItems':'end','&:last-child':{marginBottom:30,borderBottom:`2px solid ${theme.palette.primary.light}`},[theme.breakpoints.down('sm')]:{padding:'20px 34px'}}));const TableHeader=(0,core_1.styled)(core_1.Grid)(({theme})=>({padding:'23px 64px',[theme.breakpoints.down('sm')]:{padding:'23px 24px'}}));const LinearBar=(0,core_1.styled)(ProgressBar_1.ProgressBar)({marginBottom:'-3px',marginTop:30});const NoTokens=(0,core_1.styled)(core_1.Grid)(({theme})=>({padding:'33px 64px',borderTop:`2px solid ${theme.palette.primary.light}`,paddingBottom:0,display:'flex',alignItems:'end',[theme.breakpoints.down('sm')]:{padding:'20px 34px'}}));const styles=(0,core_1.makeStyles)({root:{'borderRadius':'4px 4px 0px 0px','maxWidth':135,'marginRight':10,'background':'#3D3D3D','&:before':{opacity:0.5}},selected:{'background':'rgba(124, 255, 181, 0.15)','&:before':{opacity:0.15}}});const Header=(0,core_1.styled)(core_1.Grid)(({theme})=>({padding:'20px 64px',[theme.breakpoints.down('sm')]:{padding:'20px 34px'}}));const UpVotesDialog=({daoAddress,proposalAddress,favor})=>{const [open,setOpen]=react_1.default.useState(false);const {data:proposal,isLoading}=(0,useProposal_1.useProposal)(daoAddress,proposalAddress);const theme=(0,core_1.useTheme)();const [selectedTab,setSelectedTab]=react_1.default.useState(0);const style=styles();const quorumThreshold=(proposal===null||proposal===void 0?void 0:proposal.quorumThreshold)||new bignumber_js_1.BigNumber(0);const votesData=proposal===null||proposal===void 0?void 0:proposal.voters;const {votesSum}=(0,useVotesStats_1.useVotesStats)({quorumThreshold,upVotes:(proposal===null||proposal===void 0?void 0:proposal.upVotes)||new bignumber_js_1.BigNumber(0),downVotes:(proposal===null||proposal===void 0?void 0:proposal.downVotes)||new bignumber_js_1.BigNumber(0)});const votes=(0,react_1.useMemo)(()=>{if(!votesData){return[];}if(selectedTab===0){return votesData;}if(selectedTab===1){return votesData.filter(voteData=>voteData.support);}if(selectedTab===2){return votesData.filter(voteData=>!voteData.support);}},[votesData,selectedTab]);const handleClickOpen=()=>{setOpen(true);};const handleClose=()=>{setOpen(false);};return(0,jsx_runtime_1.jsxs)('div',{children:[(0,jsx_runtime_1.jsx)(StyledViewButton,{variant:'contained',size:'small',color:'secondary',onClick:handleClickOpen,children:'VIEW'}),(0,jsx_runtime_1.jsxs)(CustomDialog,{open:open,onClose:handleClose,'aria-labelledby':'alert-dialog-title','aria-describedby':'alert-dialog-description',children:[(0,jsx_runtime_1.jsx)(Title,{id:'alert-dialog-title',color:'textSecondary',children:(0,jsx_runtime_1.jsx)(core_1.Grid,{container:true,direction:'row',children:(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,xs:12,children:(0,jsx_runtime_1.jsx)(CloseButton,{color:'textSecondary',align:'right',onClick:handleClose,children:'X'})})})}),(0,jsx_runtime_1.jsx)(core_1.DialogContent,{children:(0,jsx_runtime_1.jsxs)(core_1.DialogContentText,{id:'alert-dialog-description',children:[(0,jsx_runtime_1.jsxs)(TableHeader,{container:true,direction:'row',alignItems:'center',children:[(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,xs:12,children:(0,jsx_runtime_1.jsxs)(core_1.Typography,{variant:'subtitle1',style:{color:favor?theme.palette.secondary.main:theme.palette.error.main},children:['VOTES',' ']})}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,xs:12,children:[(0,jsx_runtime_1.jsx)(TextHeader,{variant:'h3',color:'textSecondary',children:proposal?votesSum.toString():'-'}),(0,jsx_runtime_1.jsx)(VotersProgress_1.VotersProgress,{wrapAll:true,showButton:false,daoId:daoAddress,proposalId:proposalAddress})]})]}),(0,jsx_runtime_1.jsx)(AppTabBar_1.AppTabBar,{class1:style,value:selectedTab,setValue:setSelectedTab,labels:['ALL','SUPPORT','OPPOSE'],centered:true}),(0,jsx_runtime_1.jsx)(TabPanel_1.TabPanel,{value:selectedTab,index:0}),isLoading?(0,jsx_runtime_1.jsx)(jsx_runtime_1.Fragment,{children:(0,jsx_runtime_1.jsx)(core_1.Grid,{container:true,direction:'row',justifyContent:'center',children:(0,jsx_runtime_1.jsx)(core_1.CircularProgress,{color:'secondary'})})}):votes&&votes.length>0?(0,jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment,{children:[(0,jsx_runtime_1.jsxs)(Header,{container:true,direction:'row',alignItems:'center',children:[(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,xs:6,children:(0,jsx_runtime_1.jsxs)(core_1.Typography,{variant:'subtitle1',color:'textSecondary',children:[votes.length,' ',votes.length!==1?' addresses':' address']})}),(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,xs:6,container:true,justifyContent:'flex-end',children:(0,jsx_runtime_1.jsx)(core_1.Typography,{variant:'subtitle1',color:'textSecondary',children:'Votes'})})]}),votes.map((vote,index)=>{return(0,jsx_runtime_1.jsxs)(Row,{container:true,direction:'row',alignItems:'center',children:[(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,xs:6,children:[(0,jsx_runtime_1.jsx)(core_1.Typography,{variant:'subtitle1',color:'textSecondary',children:(0,jsx_runtime_1.jsx)(UserBadge_1.UserBadge,{address:vote.address})}),(0,jsx_runtime_1.jsx)(LinearBar,{color:'secondary',variant:'determinate',favor:vote.support,value:votesSum?vote.value.div(votesSum).multipliedBy(100).toNumber():0})]}),(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,xs:6,children:(0,jsx_runtime_1.jsx)(core_1.Typography,{variant:'subtitle1',color:'textSecondary',align:'right',children:proposal?vote.value.toString():'-'})})]},index);})]}):(0,jsx_runtime_1.jsx)(NoTokens,{container:true,direction:'row',alignItems:'center',children:(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,xs:12,children:(0,jsx_runtime_1.jsx)(core_1.Typography,{children:'No votes'})})})]})})]})]});};exports.UpVotesDialog=UpVotesDialog;