'use strict';var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||('get'in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k];}};}Object.defineProperty(o,k2,desc);}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k];});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,'default',{enumerable:true,value:v});}:function(o,v){o['default']=v;});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=='default'&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result;};var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}function rejected(value){try{step(generator['throw'](value));}catch(e){reject(e);}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{'default':mod};};Object.defineProperty(exports,'__esModule',{value:true});exports.FreezeDialog=void 0;const jsx_runtime_1=require('react/jsx-runtime');const react_1=__importStar(require('react'));const core_1=require('@material-ui/core');const useFreeze_1=require('../../../services/contracts/baseDAO/hooks/useFreeze');const bignumber_js_1=__importDefault(require('bignumber.js'));const useDAO_1=require('../../../services/services/dao/hooks/useDAO');const ResponsiveDialog_1=require('./ResponsiveDialog');const router_1=require('../pages/DAO/router');const ProposalFormInput_1=require('./ProposalFormInput');const useTezos_1=require('../../../services/beacon/hooks/useTezos');const tokenBalances_1=require('../../../services/bakingBad/tokenBalances');const utils_1=require('../../../services/contracts/utils');const CustomDialog=(0,core_1.styled)(ResponsiveDialog_1.ResponsiveDialog)({'& .MuiDialog-paperWidthSm':{minHeight:'400px !important'}});const CustomInput=(0,core_1.styled)(core_1.TextField)(({theme})=>({'& .MuiInputBase-input':{color:theme.palette.secondary.main}}));const CustomLabelsContainer=(0,core_1.styled)(core_1.Grid)({marginBottom:12});const CustomAmountLabel=(0,core_1.styled)(core_1.Typography)({fontWeight:500});const CustomMaxLabel=(0,core_1.styled)(core_1.Typography)({fontSize:16,paddingBottom:5,textDecoration:'underline',textUnderlineOffset:6,cursor:'pointer',marginLeft:12});const FreezeDialog=({freeze})=>{const [open,setOpen]=react_1.default.useState(false);const [amount,setAmount]=react_1.default.useState(0);const daoId=(0,router_1.useDAOID)();const {mutate}=(0,useFreeze_1.useFreeze)();const {data:dao,ledger}=(0,useDAO_1.useDAO)(daoId);const {account}=(0,useTezos_1.useTezos)();const [showMax,setShowMax]=react_1.default.useState(false);const [maxDeposit,setMaxDeposit]=react_1.default.useState(0);const [maxWithdraw,setMaxWithdraw]=react_1.default.useState(0);const handleClickOpen=()=>{setOpen(true);};const handleClose=()=>{setOpen(false);setAmount(0);};const onSubmit=(0,react_1.useCallback)(()=>__awaiter(void 0,void 0,void 0,function*(){if(dao){mutate({dao,amount:new bignumber_js_1.default(amount),freeze});handleClose();}}),[amount,dao,mutate,freeze]);(0,react_1.useMemo)(()=>__awaiter(void 0,void 0,void 0,function*(){if(!ledger){return setShowMax(false);}else{if(account&&dao){const availableBalance=yield(0,tokenBalances_1.getUserTokenBalance)(account.toString(),dao.data.network,dao.data.token.contract);setShowMax(true);if(availableBalance){const formattedBalance=(0,utils_1.parseUnits)(new bignumber_js_1.default(availableBalance),dao.data.token.decimals).dp(10,1).toNumber();setMaxDeposit(formattedBalance);}const userLedger=ledger.find(l=>l.holder.address.toLowerCase()===account.toLowerCase());if(userLedger){if(userLedger.available_balance){setMaxWithdraw(userLedger.available_balance.dp(10,1).toNumber());}}}}}),[ledger,account,dao]);return(0,jsx_runtime_1.jsxs)('div',{children:[(0,jsx_runtime_1.jsx)(core_1.Button,{onClick:handleClickOpen,variant:'contained',color:'secondary',children:freeze?'Deposit':'Withdraw'}),(0,jsx_runtime_1.jsx)(CustomDialog,{open:open,onClose:handleClose,title:freeze?'DEPOSIT':'WITHDRAW',children:(0,jsx_runtime_1.jsxs)(core_1.Grid,{container:true,direction:'column',style:{gap:36},children:[(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,children:(0,jsx_runtime_1.jsxs)(core_1.Typography,{variant:'body2',color:'textPrimary',children:['Confirm the ',freeze?'deposit':'withdrawal',' of your tokens']})}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,children:[(0,jsx_runtime_1.jsxs)(CustomLabelsContainer,{item:true,container:true,direction:'row',justifyContent:'space-between',alignItems:'center',children:[(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,xs:3,children:(0,jsx_runtime_1.jsx)(CustomAmountLabel,{children:'Amount'})}),(0,jsx_runtime_1.jsxs)(core_1.Grid,{item:true,container:true,direction:'row',xs:9,justifyContent:'flex-end',children:[showMax&&freeze?(0,jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment,{children:[(0,jsx_runtime_1.jsxs)(core_1.Typography,{children:[maxDeposit,' ',dao===null||dao===void 0?void 0:dao.data.token.symbol]}),(0,jsx_runtime_1.jsx)(CustomMaxLabel,{color:'secondary',onClick:()=>setAmount(maxDeposit),children:'Use Max'})]}):null,showMax&&!freeze?(0,jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment,{children:[(0,jsx_runtime_1.jsxs)(core_1.Typography,{children:[maxWithdraw,' ',dao===null||dao===void 0?void 0:dao.data.token.symbol]}),(0,jsx_runtime_1.jsx)(CustomMaxLabel,{color:'secondary',onClick:()=>setAmount(maxWithdraw),children:'Use Max'})]}):null]})]}),(0,jsx_runtime_1.jsx)(ProposalFormInput_1.ProposalFormInput,{children:(0,jsx_runtime_1.jsx)(CustomInput,{value:amount,type:'number',placeholder:'0',onChange:newValue=>setAmount(newValue.target.value),onClick:newValue=>{if(amount===0){setAmount('');}return;},inputProps:{min:0},InputProps:{disableUnderline:true,endAdornment:(0,jsx_runtime_1.jsx)(core_1.InputAdornment,{position:'end',children:(0,jsx_runtime_1.jsx)(core_1.Typography,{color:'secondary',children:dao===null||dao===void 0?void 0:dao.data.token.symbol})})}})})]}),(0,jsx_runtime_1.jsx)(core_1.Grid,{item:true,container:true,direction:'row',alignItems:'center',justifyContent:'center',children:(0,jsx_runtime_1.jsx)(core_1.Button,{variant:'contained',color:'secondary',disabled:!amount,onClick:onSubmit,children:'Submit'})})]})})]});};exports.FreezeDialog=FreezeDialog;