'use strict';var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}function rejected(value){try{step(generator['throw'](value));}catch(e){reject(e);}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{'default':mod};};Object.defineProperty(exports,'__esModule',{value:true});exports.useTransfers=void 0;const react_query_1=require('react-query');const useDAO_1=require('../../../services/dao/hooks/useDAO');const useTezos_1=require('../../../beacon/hooks/useTezos');const transfers_1=require('../../../bakingBad/transfers');const utils_1=require('../../utils');const bignumber_js_1=require('bignumber.js');const services_1=require('../../../services/dao/services');const dayjs_1=__importDefault(require('dayjs'));const useTransfers=contractAddress=>{const {data:dao}=(0,useDAO_1.useDAO)(contractAddress);const {network}=(0,useTezos_1.useTezos)();const result=(0,react_query_1.useQuery)(['transfers',contractAddress],()=>__awaiter(void 0,void 0,void 0,function*(){const tokenTransfersDTO=yield(0,transfers_1.getDAOTransfers)(dao.data.address,network);const xtzTransfersDTO=yield(0,services_1.getXTZTransfers)(dao.data.address);const xtzTransfers=xtzTransfersDTO.transfer.map(t=>Object.assign(Object.assign({},t),{recipient:contractAddress,sender:t.from_address,date:t.timestamp,name:'XTZ',hash:t.hash,amount:(0,utils_1.mutezToXtz)(new bignumber_js_1.BigNumber(t.amount))}));const tokenTransfers=tokenTransfersDTO.map(t=>Object.assign(Object.assign({},t),{recipient:t.to,sender:t.from,date:t.timestamp,name:t.token.symbol==='OBJKT'?`${t.token.symbol}#${t.token.token_id}`:t.token.symbol||'-',hash:t.hash,amount:(0,utils_1.parseUnits)(new bignumber_js_1.BigNumber(t.amount),t.token.decimals)}));return tokenTransfers.concat(xtzTransfers).sort((a,b)=>(0,dayjs_1.default)(a.date).isAfter((0,dayjs_1.default)(b.date))?1:-1);}),{enabled:!!dao});return result;};exports.useTransfers=useTransfers;